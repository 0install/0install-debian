From 6ba42970a2c41f46cc306c9219552fb6fc98f03a Mon Sep 17 00:00:00 2001
From: Thomas Leonard <talex5@gmail.com>
Date: Mon, 14 Jan 2013 15:12:08 +0000
Subject: [PATCH] Pick correct zsh directory depending on install target

---
 setup.py |    9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/setup.py b/setup.py
index 18a3a3a..4794679 100644
--- a/setup.py
+++ b/setup.py
@@ -118,6 +118,13 @@ class my_install(install):
 		if self.home:
 			self.run_command('adjust_scripts_for_home')
 
+if '--home' in sys.argv:
+	zsh_functions_dir = '.zsh'
+elif '--install-layout=deb' in sys.argv:
+	zsh_functions_dir = 'share/zsh/vendor-completions'
+else:
+	zsh_functions_dir = 'share/zsh/site-functions'
+
 setup(name="zeroinstall-injector",
       version=zeroinstall.version,
       description="The Zero Install Injector (0launch)",
@@ -128,7 +135,7 @@ setup(name="zeroinstall-injector",
       data_files = [('man/man1', ['0launch.1', '0alias.1', '0store-secure-add.1', '0store.1', '0desktop.1', '0install.1']),
 		    ('share/applications', ['share/applications/zeroinstall-add.desktop', 'share/applications/zeroinstall-manage.desktop']),
 		    ('share/bash-completion/completions', ['share/bash-completion/completions/0install']),
-		    ('share/zsh/site-functions', ['share/zsh/site-functions/_0install']),
+		    (zsh_functions_dir, ['share/zsh/site-functions/_0install']),
 		    ('share/desktop-directories', ['share/desktop-directories/zeroinstall.directory']),
 		    ('share/icons/hicolor/24x24/apps', ['share/icons/24x24/zeroinstall.png']),
 		    ('share/icons/hicolor/48x48/apps', ['share/icons/48x48/zeroinstall.png']),
-- 
1.7.10.4

