From 884e708a7fd0f418253efeebc1799cda0e74eaaa Mon Sep 17 00:00:00 2001
From: Thomas Leonard <talex5@gmail.com>
Date: Thu, 4 Jul 2013 11:10:23 +0100
Subject: [PATCH 2/2] Added TYPE and DEBUG options to build

Debian wants bytecode binaries with no debug symbols.
---
 ocaml/Makefile | 18 ++++++++++--------
 ocaml/_tags    |  2 +-
 2 files changed, 11 insertions(+), 9 deletions(-)

diff --git a/ocaml/Makefile b/ocaml/Makefile
index f31bad7..f1d9196 100644
--- a/ocaml/Makefile
+++ b/ocaml/Makefile
@@ -1,5 +1,7 @@
 BUILDDIR=_build
-OCAMLBUILD=ocamlbuild -use-ocamlfind -build-dir "${BUILDDIR}"
+TYPE=native
+DEBUG=-cflags -g
+OCAMLBUILD=ocamlbuild ${DEBUG} -use-ocamlfind -build-dir "${BUILDDIR}"
 ifeq ($(OS), Windows_NT)
   OCAMLBUILDFLAGS = -lflag -cclib -lflag -lshell32
 endif
@@ -9,21 +11,21 @@ endif
 all: test
 
 test: ocaml
-	$(OCAMLBUILD) $(OCAMLBUILDFLAGS) tests/test.native
-	(cd tests && ../_build/tests/test.native)
+	$(OCAMLBUILD) $(OCAMLBUILDFLAGS) tests/test.$(TYPE)
+	(cd tests && ../_build/tests/test.$(TYPE))
 
 ocaml: 
-	$(OCAMLBUILD) $(OCAMLBUILDFLAGS) main.native
+	$(OCAMLBUILD) $(OCAMLBUILDFLAGS) main.$(TYPE)
 	if [ "$(OS)" = "Windows_NT" ];then make ocaml_windows; else make ocaml_posix; fi
 
 ocaml_windows:
-	cp _build/main.native _build/0install.exe
+	cp _build/main.$(TYPE) _build/0install.exe
 	cp 0install.exe.manifest _build/
-	$(OCAMLBUILD) $(OCAMLBUILDFLAGS) runenv.native
-	cp _build/runenv.native _build/0install-runenv.exe
+	$(OCAMLBUILD) $(OCAMLBUILDFLAGS) runenv.$(TYPE)
+	cp _build/runenv.$(TYPE) _build/0install-runenv.exe
 
 ocaml_posix:
-	cp _build/main.native _build/0install
+	cp _build/main.$(TYPE) _build/0install
 	[ -f 0install ] || ln -s _build/0install 0install
 
 byte:
diff --git a/ocaml/_tags b/ocaml/_tags
index c93a626..31c3537 100644
--- a/ocaml/_tags
+++ b/ocaml/_tags
@@ -1,4 +1,4 @@
-true: debug, annot, warn(A-4), package(yojson,xmlm,unix,str)
+true: annot, warn(A-4), package(yojson,xmlm,unix,str)
 <tests/test.*>: package(oUnit)
 "support": for-pack(Support)
 <*.native> or <tests/*.native>: linkdep_win(support/windows.o)
-- 
1.8.3.1

